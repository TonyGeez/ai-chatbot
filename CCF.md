[
  "Executive Summary](#executive-summary)\n- [Tech Stack](#tech-stack)\n- [Project Structure](#project-structure)\n- [Architecture Overview](#architecture-overview)\n- [Entry Points](#entry-points)\n- [Core Modules & Components](#core-modules--components)\n- [Database Architecture](#database-architecture)\n- [Data Models & Schema](#data-models--schema)\n- [API Documentation](#api-documentation)\n- [Authentication & Authorization](#authentication--authorization)\n- [State Management](#state-management)\n- [Caching Strategy](#caching-strategy)\n- [Background Jobs & Queues](#background-jobs--queues)\n- [Configuration](#configuration)\n- [Build & Deployment](#build--deployment)\n- [External Integrations](#external-integrations)\n- [Critical Functions & Algorithms](#critical-functions--algorithms)\n- [Security Considerations](#security-considerations)\n- [Performance Characteristics](#performance-characteristics)\n- [Error Handling & Logging](#error-handling--logging)\n- [Testing Strategy](#testing-strategy)\n- [Code Quality Observations](#code-quality-observations)\n- [Dependency Analysis](#dependency-analysis)\n- [Transaction Management](#transaction-management)\n- [Rollback Strategies](#rollback-strategies)\n- [File Inventory](#file-inventory)\n- [Key Findings & Recommendations](#key-findings--recommendations)\n- [Glossary](#glossary)\n\n## Executive Summary\n\nThis is a Next.js-based AI chatbot application using the Vercel AI SDK with multi-provider LLM support. The application features document/artifact creation, database-persisted chat history, and user authentication. It's designed as a scalable, full-stack application with a focus on real-time streaming capabilities and interactive AI experiences.\n\nThe application supports multiple AI providers including OpenRouter, Anthropic, Google, xAI, and OpenAI. It uses PostgreSQL (via Neon Serverless) for data persistence with Drizzle ORM for database operations. The frontend is built with React Server Components and Client Components, using Tailwind CSS for styling with shadcn/ui components.\n\n## Tech Stack\n\n- **Languages**: TypeScript (primary), JavaScript, SQL\n- **Frameworks**: Next.js 16.0.10 with App Router (React 19), Vercel AI SDK 6.0.0-beta\n- **Key Libraries**: \n  - Auth.js (NextAuth.js 5.0.0-beta) for authentication\n  - Drizzle ORM for database operations\n  - Tailwind CSS + shadcn/ui for styling\n  - React for UI components\n  - Framer Motion for animations\n  - Zod for validation\n- **Database**: PostgreSQL with Drizzle ORM\n- **Infrastructure**: Vercel (deployment), Neon Serverless Postgres (database), Vercel Blob (file storage)\n- **Caching**: Client-side SWR for data fetching\n- **Queue Systems**: Resumable streams for long-running operations\n\n## Project Structure\n\n```\n.\n├── app/                         # Next.js App Router structure\n│   ├── (auth)/                  # Authentication routes\n│   │   ├── login/page.tsx       # Login page\n│   │   ├── register/page.tsx    # Registration page\n│   │   ├── auth.config.ts        # Auth configuration\n│   │   ├── auth.ts              # Authentication implementation\n│   │   └── actions.ts           # Auth-related server actions\n│   ├── (chat)/                  # Chat application\n│   │   ├── api/                 # API routes\n│   │   │   ├── chat/            # Chat API endpoint\n│   │   │   │   ├── route.ts     # Main chat endpoint with streaming\n│   │   │   │   └── schema.ts    # Request validation schema\n│   │   │   ├── document/        # Document API\n│   │   │   │   └── route.ts\n│   │   │   ├── files/           # File upload API\n│   │   │   │   └── upload/\n│   │   │   │       └── route.ts\n│   │   │   ├── history/         # Chat history API\n│   │   │   │   └── route.ts\n│   │   │   ├── providers/       # Provider config API\n│   │   │   │   └── config/\n│   │   │   │       └── route.ts\n│   │   │   ├── suggestions/      # Suggestions API\n│   │   │   │   └── route.ts\n│   │   │   └── vote/            # Voting API\n│   │   │       └── route.ts\n│   │   ├── chat/                # Chat interface route\n│   │   │   └── [id]/            # Dynamic chat route\n│   │   │       └── page.tsx\n│   │   ├── actions.ts           # Server actions for chat\n│   │   ├── layout.tsx           # Chat layout\n│   │   ├── page.tsx             # Main chat page\n│   │   └── ...\n│   ├── layout.tsx               # Root layout\n│   └── globals.css             # Global styles\n├── artifacts/                  # Artifact/document handlers\n│   ├── code/                   # Code artifact implementation\n│   ├── image/                  # Image artifact implementation\n│   ├── sheet/                  # Spreadsheet artifact implementation\n│   ├── text/                   # Text artifact implementation\n│   └── actions.ts             # Artifact-related actions\n├── components/                 # React UI components\n│   ├── ui/                     # shadcn/ui components\n│   ├── chat.tsx               # Main chat component\n│   ├── message.tsx            # Message display components\n│   ├── artifact.tsx           # Artifact display and editor\n│   └── ...\n├── hooks/                     # Custom React hooks\n├── lib/                       # Core application logic\n│   ├── ai/                    # AI integration\n│   │   ├── tools/             # AI tools (create-document, etc.)\n│   │   ├── providers.ts       # AI provider configuration\n│   │   ├── models.ts          # Model definitions\n│   │   └── prompts.ts        # System prompts\n│   ├── db/                    # Database operations\n│   │   ├── schema.ts          # Database schema\n│   │   ├── queries.ts         # Database queries\n│   │   └── migrations/        # Database migrations\n│   ├── artifacts/            # Artifact handling (server-side)\n│   ├── types.ts               # TypeScript types\n│   ├── utils.ts              # Utility functions\n│   └── errors.ts             # Error handling\n└── tests/                    # Test files\n```\n\n## Architecture Overview\n\nThe application follows a Next.js App Router architecture with a clear separation between server and client components. It uses React Server Components for data fetching and rendering where possible, with client components for interactive UI elements.\n\n### Architecture Diagram\n\n```\n┌────────────────────┐    ┌────────────────────┐\n│   Client (React)   │    │   Server (Next.js) │\n│                    │    │                    │\n│  Client Components │◄──►│ Server Components  │\n│  (hooks, state)    │    │  (RSC, actions)    │\n└─────────┬──────────┘    └─────────▲──────────┘\n          │                         │\n          │    HTTP/Server-Sent     │\n          └────────────Events───────┘\n                    │\n          ┌─────────▼──────────┐\n          │    AI Providers    │\n          │ (OpenRouter, etc.) │\n          └────────────────────┘\n```\n\n### Architectural Pattern\n\nThe application uses a component-based architecture with clear separation of concerns:\n\n1. **Presentation Layer**: React components in `components/` directory\n2. **Business Logic Layer**: Server actions, API routes, and library functions in `lib/` and `app/api/`\n3. **Data Access Layer**: Database queries and ORM in `lib/db/`\n4. **External Services Layer**: AI provider integrations in `lib/ai/`\n\n## Entry Points\n\n1. **Main Application**: `app/(chat)/page.tsx` - The main chat interface\n2. **Authentication**: `app/(auth)/login/page.tsx` and `app/(auth)/register/page.tsx`\n3. **API Endpoints**: \n   - Chat API: `app/(chat)/api/chat/route.ts`\n   - Document API: `app/(chat)/api/document/route.ts`\n4. **Server Actions**: Functions in `app/(chat)/actions.ts`\n\n## Core Modules & Components\n\n### Authentication Module\n- **Location**: `app/(auth)/auth.ts`\n- **Purpose**: User authentication and session management using NextAuth.js\n- **Key Functions**: \n  - `signIn` - User login\n  - `signOut` - User logout\n  - `auth` - Session verification\n- **Dependencies**: NextAuth.js, bcrypt-ts for password hashing\n- **Used By**: All protected routes and API endpoints\n\n### Chat Module\n- **Location**: `app/(chat)/chat.tsx`\n- **Purpose**: Main chat interface with streaming capabilities\n- **Key Functions**: \n  - `useChat` - Hook for chat functionality\n  - `sendMessage` - Send messages to AI\n  - `regenerate` - Regenerate AI responses\n- **Dependencies**: Vercel AI SDK, SWR for data fetching\n- **Used By**: Chat page component\n\n### AI Integration Module\n- **Location**: `lib/ai/`\n- **Purpose**: Integration with multiple AI providers and models\n- **Key Functions**: \n  - `getLanguageModel` - Retrieve configured language model\n  - `streamText` - Stream text responses from AI\n  - AI tools (create-document, get-weather, etc.)\n- **Dependencies**: Vercel AI SDK, OpenRouter provider\n- **Used By**: Chat API, artifact handlers\n\n### Database Module\n- **Location**: `lib/db/`\n- **Purpose**: Database operations and schema management\n- **Key Functions**: \n  - `saveChat`, `getChatById` - Chat operations\n  - `saveMessages`, `getMessagesByChatId` - Message operations\n  - `saveDocument`, `getDocumentById` - Document operations\n- **Dependencies**: Drizzle ORM, PostgreSQL\n- **Used By**: All modules requiring data persistence\n\n### Artifact Module\n- **Location**: `lib/artifacts/` and `artifacts/`\n- **Purpose**: Document/artifact creation and management\n- **Key Functions**: \n  - Artifact handlers for text, code, sheet, and image\n  - `createDocument` - Create new artifacts\n  - `updateDocument` - Update existing artifacts\n- **Dependencies**: Vercel AI SDK, Codemirror (for code editor)\n- **Used By**: Chat API, UI components\n\n## Database Architecture\n\n### Database Schema\n\nThe application uses PostgreSQL with the following main tables:\n\n1. **User** - Authentication records\n   - `id` (UUID) - Primary key\n   - `email` (varchar) - User email\n   - `password` (varchar) - Hashed password\n\n2. **Chat** - Chat sessions with visibility settings\n   - `id` (UUID) - Primary key\n   - `createdAt` (timestamp) - Creation timestamp\n   - `title` (text) - Chat title\n   - `userId` (UUID) - Foreign key to User\n   - `visibility` (varchar) - Public/private visibility\n   - `model` (text) - Selected AI model\n   - `systemInstruction` (text) - Custom system instructions\n   - `temperature` (text) - Model temperature setting\n\n3. **Message_v2** - Messages with parts/attachments (new schema)\n   - `id` (UUID) - Primary key\n   - `chatId` (UUID) - Foreign key to Chat\n   - `role` (varchar) - Message role (user/assistant)\n   - `parts` (json) - Message content parts\n   - `attachments` (json) - Attached files\n   - `createdAt` (timestamp) - Creation timestamp\n\n4. **Document** - Created artifacts\n   - `id` (UUID) - Primary key\n   - `createdAt` (timestamp) - Creation timestamp\n   - `title` (text) - Document title\n   - `content` (text) - Document content\n   - `kind` (varchar) - Document type (text/code/sheet)\n   - `userId` (UUID) - Foreign key to User\n\n5. **Suggestion** - Document suggestions\n   - `id` (UUID) - Primary key\n   - `documentId` (UUID) - Foreign key to Document\n   - `originalText` (text) - Original text\n   - `suggestedText` (text) - Suggested replacement\n   - `description` (text) - Suggestion description\n   - `isResolved` (boolean) - Resolution status\n   - `userId` (UUID) - Foreign key to User\n   - `createdAt` (timestamp) - Creation timestamp\n\n6. **Vote_v2** - Message upvotes/downvotes\n   - `chatId` (UUID) - Foreign key to Chat\n   - `messageId` (UUID) - Foreign key to Message_v2\n   - `isUpvoted` (boolean) - Vote direction\n\n### Entity Relationships\n\n- **One-to-Many (1-N)**: \n  - User → Chats\n  - Chat → Messages\n  - User → Documents\n  - Document → Suggestions\n  - Chat → Votes\n  - User → ProviderConfig\n\n- **Many-to-Many (N-N)**: \n  - None explicitly defined (handled through junction tables where needed)\n\n- **One-to-One (1-1)**: \n  - None explicitly defined\n\n### ORM/ODM Implementation\n\n- **Tool**: Drizzle ORM\n- **Configuration**: PostgreSQL connection via `postgres` package\n- **Models Location**: `lib/db/schema.ts`\n- **Query Patterns**: \n  - Select, insert, update, delete operations\n  - Joins for complex queries\n  - Aggregation functions for statistics\n\n### Migrations\n\n- **Migration Tool**: Drizzle Kit\n- **Migration Files**: `lib/db/migrations/`\n- **Migration Strategy**: SQL migration files with versioning\n- **Seeding Strategy**: Manual seeding through application logic\n\n### Database Transactions\n\n- **ACID Compliance**: Managed by PostgreSQL with ORM support\n- **Transaction Patterns**: Used in chat deletion and message saving\n- **Isolation Levels**: Default PostgreSQL isolation levels\n- **Rollback Strategies**: Database-level rollback on error\n\n## Data Models & Schema\n\nThe application uses TypeScript types and Zod schemas for data validation:\n\n1. **ChatMessage** - Message structure with parts, metadata, and custom data types\n2. **ChatModel** - AI model definitions with provider and description\n3. **Document** - Artifact structure with content and metadata\n4. **User** - User authentication data\n5. **Chat** - Chat session data with settings\n6. **Attachment** - File attachment structure\n\n## API Documentation\n\n### Endpoints\n\n1. **POST /api/chat** - Main chat endpoint with streaming\n   - Parameters: id, message, messages, selectedChatModel, selectedVisibilityType\n   - Purpose: Send messages to AI and receive streaming responses\n\n2. **DELETE /api/chat** - Delete chat\n   - Parameters: id (query)\n   - Purpose: Remove chat and associated data\n\n3. **GET /api/document** - Get document by ID\n   - Parameters: id (query)\n   - Purpose: Retrieve document content and history\n\n4. **POST /api/document** - Create/update document\n   - Parameters: id (query), title, content, kind (body)\n   - Purpose: Save document changes\n\n5. **GET /api/history** - Get chat history\n   - Parameters: limit, startingAfter, endingBefore (query)\n   - Purpose: Paginated chat history retrieval\n\n6. **POST /api/vote** - Vote on messages\n   - Parameters: chatId, messageId, type (body)\n   - Purpose: Vote messages up or down\n\n7. **GET /api/vote** - Get votes for chat\n   - Parameters: chatId (query)\n   - Purpose: Retrieve voting data for a chat\n\n## Authentication & Authorization\n\n### Authentication Methods\n\nThe application uses NextAuth.js with Credentials providers:\n\n1. **Email/Password Authentication**: \n   - Uses bcrypt-ts for password hashing\n   - Custom authorize function for credential validation\n   - Session management via JWT\n\n2. **Guest Authentication**: \n   - Automatic creation of guest users\n   - Random email/password generation for guests\n\n### Authorization Strategy\n\n- Session-based authorization with JWT tokens\n- User ID verification for data access\n- Role-based access control (guest vs regular users)\n\n### Session Management\n\n- JWT-based sessions with cookie storage\n- Session expiration handled by NextAuth.js\n- Server-side session verification in API routes and server actions\n\n## State Management\n\n### Frontend State\n\n- **React State**: useState and useReducer for component state\n- **Context API**: ThemeProvider for theme management\n- **SWR**: Data fetching and caching with automatic revalidation\n- **Custom Hooks**: useChat, useMessages, useArtifact for specialized state\n\n### Backend State\n\n- **Database**: Persistent state storage\n- **Session Storage**: User authentication state\n- **In-memory**: Temporary state for streaming operations\n\n### Shared State\n\n- **Server-Sent Events**: Real-time updates from API to client\n- **WebSocket-like**: Resumable streams for long-running operations\n\n## Caching Strategy\n\n### Cache Layers\n\n- **Client-side**: SWR for data fetching with automatic revalidation\n- **Server-side**: Next.js cache for server components\n- **Browser**: HTTP caching for static assets\n\n### Cache Technology\n\n- **SWR**: Client-side data fetching and caching\n- **Next.js**: Built-in caching for server components\n\n### Cache Invalidation\n\n- **SWR**: Automatic revalidation based on focus, intervals, and mutations\n- **Manual**: Mutate function for explicit cache updates\n\n### Cache Keys\n\n- **SWR**: URL-based keys for API endpoints\n- **Next.js**: Route-based caching with tags\n\n## Background Jobs & Queues\n\n### Queue System\n\n- **Resumable Streams**: For handling long-running AI operations\n- **Redis**: For production deployments (optional)\n\n### Job Types\n\n- **AI Streaming**: Long-running AI generations\n- **Data Processing**: Database operations and transformations\n\n### Job Scheduling\n\n- **Real-time**: Triggered by user actions\n- **Background**: Automatic with client-side polling\n\n### Worker Configuration\n\n- **Browser**: Client-side workers for streaming\n- **Server**: Edge functions for API endpoints\n\n### Failure Handling\n\n- **Retry Logic**: Automatic retries with exponential backoff\n- **Error Handling**: Comprehensive error capture and reporting\n\n## Configuration\n\n### Environment Variables\n\nThe application requires several environment variables:\n\n1. **POSTGRES_URL** - Database connection string\n2. **NEXTAUTH_SECRET** - Authentication secret\n3. **OPENROUTER_API_KEY** - AI provider API key\n4. **BLOB_READ_WRITE_TOKEN** - Vercel Blob storage token\n5. **AI_GATEWAY_API_KEY** - Required for non-Vercel deployments\n\n### Configuration Files\n\n1. **next.config.ts** - Next.js configuration\n2. **drizzle.config.ts** - Database migration configuration\n3. **biome.jsonc** - Code quality and formatting configuration\n4. **tailwind.config.ts** - Styling configuration\n\n## Build & Deployment\n\n### Build Process\n\n1. **Dependency Installation**: `pnpm install`\n2. **Database Migration**: `pnpm db:migrate`\n3. **TypeScript Compilation**: Next.js built-in compilation\n4. **Asset Optimization**: Next.js automatic asset optimization\n\n### Deployment Pipeline\n\n- **Vercel**: One-click deployment with automatic CI/CD\n- **Manual**: Standard Node.js deployment process\n\n### Environment Setup\n\n1. Configure environment variables\n2. Set up database connection\n3. Configure authentication secrets\n4. Deploy application with build commands\n\n## External Integrations\n\n### AI Providers\n\n1. **OpenRouter** - Main AI provider with multiple model support\n2. **Anthropic** - Claude models\n3. **OpenAI** - GPT models\n4. **Google** - Gemini models\n5. **xAI** - Grok models\n\n### Third-Party Services\n\n1. **Open-Meteo** - Weather data for get-weather tool\n2. **Vercel Blob** - File storage\n3. **Neon Serverless Postgres** - Database\n\n### Webhooks\n\n#### Incoming Webhooks\n\n- None explicitly defined in the codebase\n\n#### Outgoing Webhooks\n\n- **AI Provider APIs**: Requests to OpenRouter and other providers\n- **Geocoding API**: For weather tool location lookups\n\n#### Webhook Security\n\n- API key authentication for AI providers\n- HTTPS encryption for all external requests\n\n## Critical Functions & Algorithms\n\n### Streaming Algorithm\n\nThe application uses Vercel AI SDK's streaming capabilities with resumable streams for handling long-running operations. Key features:\n\n1. **Real-time Updates**: Server-Sent Events for streaming responses\n2. **Resumable Operations**: Redis-backed continuation for long operations\n3. **Tool Integration**: Seamless integration with AI tools during streaming\n\n### Message Processing\n\n1. **Content Parsing**: Multi-part message handling with attachments\n2. **Tool Execution**: Automatic tool calling and approval flows\n3. **State Management**: Complex message state with approval workflows\n\n### Document Versioning\n\nThe application maintains full history of document changes with:\n1. **Timestamp-based versions**: Each save creates a new version\n2. **Diff-based storage**: Efficient storage of changes\n3. **Version comparison**: UI for comparing document versions\n\n## Security Considerations\n\n### Security Implementations\n\n#### Input Validation\n\n- Zod schemas for API request validation\n- TypeScript types for compile-time validation\n- Sanitization of user inputs before database storage\n\n#### SQL Injection Prevention\n\n- Drizzle ORM with parameterized queries\n- No direct SQL string concatenation\n- ORM-level protection against injection attacks\n\n#### XSS Prevention\n\n- React's built-in XSS protection\n- Proper escaping of user content\n- Content Security Policy headers\n\n#### CSRF Protection\n\n- NextAuth.js session-based authentication\n- No reliance on cookies for critical operations\n- Server-side verification of user context\n\n#### Authentication Security\n\n- bcrypt-ts for password hashing with salt\n- JWT tokens with secure configuration\n- Guest user system with automatic cleanup\n\n#### Authorization Checks\n\n- Server-side verification of user permissions\n- Ownership checks for all data access\n- Explicit forbidden responses for unauthorized access\n\n#### Rate Limiting\n\n- Message count limiting per user per day\n- Database-level rate limiting implementation\n- Automatic enforcement in API routes\n\n#### Secrets Management\n\n- Environment variable-based configuration\n- No hardcoded secrets in source code\n- Vercel Environment Variables for deployment\n\n### Potential Vulnerabilities\n\n1. **Environment Variables**: No .env.example file in repository\n2. **Guest Users**: Automatic creation without explicit consent\n3. **API Keys**: Direct storage of provider API keys in database\n4. **File Uploads**: No explicit validation of uploaded file content\n\n## Performance Characteristics\n\n### Performance Optimizations\n\n#### Database Indexes\n\n- Primary keys on all tables\n- Foreign key relationships with appropriate indexing\n- Timestamp-based sorting for history operations\n\n#### Query Optimization\n\n- Efficient joins for related data retrieval\n- Pagination for large dataset handling\n- Aggregated queries for statistics\n\n#### Caching\n\n- Client-side SWR for data caching\n- Server-side Next.js caching\n- Browser-level HTTP caching\n\n#### Lazy Loading\n\n- Dynamic imports for large components\n- Code splitting by route\n- Suspense boundaries for loading states\n\n#### Connection Pooling\n\n- Drizzle ORM connection pooling\n- Database connection reuse\n- Efficient resource management\n\n### Bottlenecks\n\n1. **Database Queries**: Complex joins for chat history\n2. **Streaming Operations**: Long-running AI operations\n3. **Authentication**: Password hashing overhead\n4. **Message Processing**: Complex multi-part message handling\n\n## Error Handling & Logging\n\n### Error Handling Strategy\n\nThe application uses a custom error handling system:\n\n1. **ChatSDKError Class**: Custom error class with error codes\n2. **Error Codes**: Structured error codes with type and surface\n3. **Error Responses**: Consistent error response format\n4. **Error Logging**: Selective logging based on error surface\n\n### Logging Implementation\n\n1. **Console Logging**: Basic logging for development\n2. **Error Reporting**: Detailed error objects for debugging\n3. **Vercel Integration**: Platform-level logging and monitoring\n4. **Structured Errors**: Error codes with user-friendly messages\n\n### Error Recovery\n\n1. **Automatic Retries**: Client-side request retries\n2. **Graceful Degradation**: Fallback to basic functionality\n3. **User Notifications**: Toast notifications for errors\n4. **Offline Support**: Network status detection and handling\n\n## Testing Strategy\n\n### Test Coverage\n\nThe application uses Playwright for end-to-end testing:\n\n1. **Integration Tests**: API endpoint testing\n2. **UI Tests**: Component interaction testing\n3. **Authentication Tests**: Login and session flow testing\n4. **Chat Tests**: Message sending and streaming validation\n\n### Testing Approach\n\n1. **Playwright Framework**: End-to-end browser testing\n2. **Fixtures**: Reusable test setup and teardown\n3. **Helpers**: Utility functions for common testing patterns\n4. **CI/CD Integration**: Automatic test execution on deployment\n\n### Test Locations\n\n1. **tests/e2e/** - End-to-end test files\n2. **tests/fixtures.ts** - Test fixtures and setup\n3. **tests/helpers.ts** - Test helper functions\n\n## Code Quality Observations\n\n### Strengths\n\n1. **Type Safety**: Comprehensive TypeScript usage throughout\n2. **Modular Architecture**: Clear separation of concerns\n3. **Error Handling**: Structured error management system\n4. **Performance**: Efficient streaming and caching implementations\n5. **Security**: Strong authentication and authorization patterns\n\n### Areas for Improvement\n\n1. **Documentation**: Missing inline documentation for functions\n2. **Configuration**: No .env.example file in codebase\n3. **Testing**: Limited unit test coverage\n4. **Error Messages**: Generic error messages for some database operations\n5. **File Validation**: No explicit file content validation\n\n### Potential Issues\n\n1. **Environment Setup**: Difficulty for new developers without .env.example\n2. **Guest Users**: Unlimited guest user creation without cleanup\n3. **API Key Storage**: Direct storage of sensitive keys in database\n4. **Error Granularity**: Limited error differentiation in some areas\n\n## Dependency Analysis\n\n### Key Dependencies\n\n1. **ai**: Vercel AI SDK (core dependency)\n2. **next**: Next.js framework\n3. **next-auth**: Authentication library\n4. **drizzle-orm**: Database ORM\n5. **react**: UI library\n6. **tailwindcss**: Styling framework\n\n### Dependency Management\n\n- **Package Manager**: pnpm with lockfile\n- **Versioning**: Specific versions with some ranges\n- **Security Scanning**: Not explicitly configured\n- **Update Strategy**: Manual dependency updates\n\n### Critical Dependencies\n\n1. **Vercel AI SDK**: Core functionality\n2. **Next.js**: Framework dependency\n3. **PostgreSQL**: Database connectivity\n4. **NextAuth.js**: Authentication system\n\n## Transaction Management\n\n### Database Transactions\n\nThe application uses Drizzle ORM's transaction support:\n\n1. **Multi-table Operations**: Deleting chats with related messages and votes\n2. **Atomic Operations**: Ensuring data consistency\n3. **Error Rollback**: Automatic rollback on failures\n4. **Nested Operations**: Complex data operations with foreign keys\n\n### Transaction Boundaries\n\n1. **Chat Deletion**: Entire chat removal with related data\n2. **Message Operations**: Saving multiple messages atomically\n3. **Document Updates**: Saving document with new version\n\n## Rollback Strategies\n\n### Database Rollback\n\n1. **Single Operation**: ORM-level rollback on error\n2. **Multi-table**: Cascading deletions with rollback\n3. **Migration Rollback**: Drizzle Kit migration rollbacks\n\n### Deployment Rollback\n\n1. **Vercel**: Platform-level deployment rollback\n2. **Manual**: Git-based rollback procedures\n\n### Data Recovery\n\n1. **Database Backups**: PostgreSQL backup procedures\n2. **Version History**: Document versioning for recovery\n3. **Session Recovery**: JWT-based session restoration\n\n## File Inventory\n\n### Source Code Files\n- **TypeScript**: Components, pages, API routes, utilities\n- **CSS**: Global styling and Tailwind configuration\n- **SQL**: Database migrations\n- **JSON**: Configuration files\n\n### Configuration Files\n- **next.config.ts**: Next.js configuration\n- **drizzle.config.ts**: Database configuration\n- **biome.jsonc**: Code quality configuration\n- **package.json**: Dependencies and scripts\n\n### Asset Files\n- **Images**: Static images and icons\n- **Fonts**: Geist font files\n- **CSS**: Global stylesheets\n\n## Key Findings & Recommendations\n\n### Key Findings\n\n1. **Advanced AI Integration**: Sophisticated implementation with multiple providers and tools\n2. **Streaming Architecture**: High-performance real-time capabilities\n3. **Document Versioning**: Comprehensive artifact management system\n4. **Strong Security**: Robust authentication and authorization\n5. **Modular Design**: Well-organized component architecture\n\n### Recommendations\n\n1. **Add .env.example**: Include sample environment configuration\n2. **Improve Documentation**: Add inline documentation to source files\n3. **Enhance Testing**: Implement unit tests for critical functions\n4. **API Key Security**: Consider encrypted storage for sensitive keys\n5. **Guest User Cleanup**: Implement automatic cleanup for expired guest users\n6. **File Validation**: Add content validation for uploaded files\n\n## Glossary\n\n- **Artifact**: A document or interactive component created during chat (text, code, sheet, image)\n- **Chat SDK**: The Vercel AI SDK used for implementing AI features\n- **Message Parts**: The modular structure of chat messages allowing mixed content types\n- **Provider**: An AI service provider (OpenRouter, Anthropic, OpenAI, etc.)\n- **Resumable Streams**: Long-running streaming operations that can be continued after interruption\n- **Tool Approval**: User consent required before AI tools execute\n- **Vote**: User feedback on message quality (upvote/downvote)\n- **Visibility**: Whether chats are public or private"
]